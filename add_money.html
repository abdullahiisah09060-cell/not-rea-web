<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deposit BTC | SBA</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <style>
        body { background: #002d72; font-family: 'Segoe UI', sans-serif; margin: 0; color: white; }
        .header { padding: 20px; display: flex; align-items: center; background: #001a41; }
        .back-btn { font-size: 24px; cursor: pointer; margin-right: 20px; text-decoration: none; color: white; }
        .container { padding: 20px; display: flex; justify-content: center; margin-top: 20px; }
        .card { background: white; width: 100%; max-width: 400px; border-radius: 30px; padding: 30px; color: #333; text-align: center; box-shadow: 0 10px 25px rgba(0,0,0,0.2); }
        .address-box { background: #f4f7f6; border: 1px solid #ddd; padding: 12px 15px; border-radius: 12px; display: flex; align-items: center; justify-content: space-between; margin: 20px 0; }
        .btc-text { word-break: break-all; font-size: 13px; color: #333; text-align: left; flex: 1; font-family: monospace; font-weight: bold; }
        .copy-btn { background: #e8f0fe; border: none; border-radius: 8px; padding: 8px; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: 0.2s; margin-left: 10px; }
        .copy-btn:hover { background: #d2e3fc; }
        .copy-btn svg { width: 20px; height: 20px; fill: #1a73e8; }
        input { width: 100%; padding: 15px; border: 1px solid #ddd; border-radius: 12px; box-sizing: border-box; font-size: 16px; margin-top: 10px; outline: none; }
        .btn-pay { width: 100%; padding: 18px; background: #2ecc71; color: white; border: none; border-radius: 12px; font-weight: bold; cursor: pointer; margin-top: 20px; font-size: 16px; }
        .btn-pay:disabled { background: #888; cursor: not-allowed; }
    </style>
</head>
<body>
    <div class="header">
        <a href="dashboard.html" class="back-btn">‚Üê</a>
        <div style="font-weight:bold; text-transform:uppercase;">Deposit BTC</div>
    </div>

    <div class="container">
        <div class="card">
            <h3 style="color:#002d72; margin-top:0;">Bitcoin Deposit</h3>
            <p style="font-size:13px; color:#666;">Copy the wallet address below and pay the exact amount to fund your account.</p>
            
            <div class="address-box">
                <span class="btc-text" id="btc-addr">bc1q789u20tcu7eshrg8gdjetwq2vvzuyd97vmzyh5</span>
                
                <button class="copy-btn" onclick="copyAddress()" id="copy-btn-ui">
                    <svg viewBox="0 0 24 24"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg>
                </button>
            </div>

            <div style="text-align:left;">
                <label style="font-size:12px; font-weight:bold; color:#002d72;">Amount Sent ($)</label>
                <input type="number" id="dep-amt" placeholder="Enter amount in USD (e.g. 500)">
            </div>

            <button class="btn-pay" onclick="submitDep()">I HAVE PAID</button>
        </div>
    </div>

    <script src="script.js"></script>
    <script>
        // Check if user is logged in
        auth.onAuthStateChanged(user => {
            if (!user) window.location.href = "index.html";
        });

        function copyAddress() {
            const text = document.getElementById('btc-addr').innerText;
            const btn = document.getElementById('copy-btn-ui');
            
            navigator.clipboard.writeText(text).then(() => {
                const originalSvg = btn.innerHTML;
                btn.style.background = "#2ecc71";
                // Simple visual feedback
                alert("BTC Address Copied!");
                setTimeout(() => {
                    btn.style.background = "#e8f0fe";
                }, 1000);
            });
        }

        function submitDep() {
            const user = auth.currentUser;
            const amt = document.getElementById('dep-amt').value;

            if(!user) return alert("Session expired. Please login.");
            if(!amt || amt <= 0) return alert("Please enter the amount you sent.");

            const btn = document.querySelector('.btn-pay');
            btn.disabled = true;
            btn.innerText = "Submitting...";

            // Send to 'requests' collection so Admin sees it
            db.collection('requests').add({
                email: user.email,
                type: 'deposit', // Keep lowercase to match Admin logic
                amount: parseFloat(amt),
                status: 'pending',
                timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                dateText: new Date().toLocaleString()
            }).then(() => {
                alert("Your deposit proof has been submitted. Your balance will update once confirmed by Admin.");
                window.location.href = 'dashboard.html';
            }).catch(err => {
                alert("Error: " + err.message);
                btn.disabled = false;
                btn.innerText = "I HAVE PAID";
            });
        }
    </script>
</body>
</html>
